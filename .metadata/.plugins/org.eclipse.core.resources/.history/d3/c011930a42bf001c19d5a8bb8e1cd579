package controler;

import java.util.ArrayList;
import java.util.List;

import entite.Pokemon;

public class Combat {

	// ATTRIBUTS
	private List<Pokemon> combattants;

	// CONSTRUCTEUR
	public Combat() {
		this.init();
	}

	// METHODES
	private void init() {
		this.combattants = new ArrayList<Pokemon>();
	}

	public void ajouterCombattant(Pokemon combattant) {
		this.combattants.add(combattant);
	}

	public void fight() {
		boolean combatEnCours = true;
		int round = 0;
		while (combatEnCours) {
			for (int i = 0; i < this.combattants.size(); i++) {
				Pokemon pokemonEnCours = this.combattants.get(i);
				if(pokemonEnCours.getPv() <= 0) {
					combatEnCours = false;
					break;
				}
				round++;
				System.out.println("DEBUT ROUND " + round);
				this.round();
			}
		}
	}
	
	public void round() {
		Pokemon pokemonAttaquant = this.whoStart();
		Pokemon pokemonDefenseur = this.whoReceivedDamages(pokemonAttaquant);
		this.fightPokemons(pokemonAttaquant, pokemonDefenseur);
		this.fightPokemons(pokemonDefenseur, pokemonAttaquant);
		System.out.println("pokemonAttaquant = " + pokemonAttaquant + " PV = "+ pokemonAttaquant.getPv() );
		System.out.println("pokemonDefenseur = " + pokemonDefenseur + " PV = "+ pokemonDefenseur.getPv() );
	}
	
	private void fightPokemons(Pokemon attaquant, Pokemon defenseur) {
		int degats = this.degatsGeneres(attaquant);
		System.out.println("Degats généré pour "+ attaquant +" est de "+ degats + " points");
		int pvDefenseur = defenseur.getPv();
		
		if(pvDefenseur > 1 ) {
			pvDefenseur = pvDefenseur - degats;
			defenseur.setPv(pvDefenseur);
		}
	}

	private Pokemon whoStart() {
		Pokemon plusRapide = this.combattants.get(0);
		for (int i = 0; i < this.combattants.size(); i++) {
			Pokemon pokemonEnCours = this.combattants.get(i);
			if (pokemonEnCours.getVitesse() > plusRapide.getVitesse()) {
				plusRapide = pokemonEnCours;
			}
		}
		return plusRapide;
	}
	
	private Pokemon whoReceivedDamages(Pokemon attaquant) {
		int indexAttaquant = this.combattants.indexOf(attaquant);
		if(indexAttaquant == 0) {
			return this.combattants.get(1);
		}else {
			return this.combattants.get(0);
		}
	}
	
	
	
	private int degatsGeneres(Pokemon pokemonAttaquant) {
		int degats = (int) (Math.random()*pokemonAttaquant.getAttaque());
		return degats;
	}
	

	
	
	
	
	
	// GETTER & SETTER
	public List<Pokemon> getCombattants() {
		return combattants;
	}

	public void setCombattants(List<Pokemon> combattants) {
		this.combattants = combattants;
	}

}
